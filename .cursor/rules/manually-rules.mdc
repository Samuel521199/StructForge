---
alwaysApply: false
---

# StructForge 项目手动应用规则

> 这些规则是可选的、需要时手动触发的规则，包含最佳实践、优化建议等。

## 1. 代码质量优化建议

### 1.1 代码格式化

- **Go**: 遵循Go官方规范，使用gofmt格式化
- **TypeScript**: 使用ESLint + Prettier

### 1.2 代码审查检查清单

在代码审查时，建议检查以下方面：

- [ ] 代码质量（可读性、可维护性）
- [ ] 架构合理性（是否符合Kratos规范）
- [ ] 测试覆盖（核心逻辑是否有测试）
- [ ] 安全性（是否有安全隐患）
- [ ] 性能（是否有性能问题）
- [ ] 是否遵循命名规范
- [ ] 是否遵循项目结构规范
- [ ] 是否有适当的注释和文档

## 2. 性能优化建议

### 2.1 前端性能优化

- 使用组件懒加载
- 按需导入依赖
- 优化打包体积
- 使用虚拟滚动处理大量数据
- 合理使用缓存

### 2.2 后端性能优化

- 使用连接池管理数据库连接
- 合理使用缓存（Redis）
- 优化数据库查询（索引、查询计划）
- 使用异步处理耗时任务
- 实现请求限流和熔断

## 3. 安全最佳实践

### 3.1 认证授权

- 使用JWT Token进行无状态认证
- 实现Refresh Token刷新机制
- 基于RBAC的权限控制
- 服务间调用使用API Key认证

### 3.2 数据安全

- 敏感信息加密存储（API密钥等）
- 使用HTTPS/WSS进行传输加密
- 输入验证防止注入攻击
- 输出转义防止XSS攻击

### 3.3 资源隔离

- 支持多租户数据隔离
- 实现资源限制防止滥用
- API限流保护

## 4. 测试最佳实践

### 4.1 单元测试

- 核心业务逻辑必须有单元测试
- 测试覆盖率要求：核心模块 > 80%
- 使用表驱动测试（Go）
- 使用Mock对象隔离依赖

### 4.2 集成测试

- 关键接口必须有集成测试
- 测试数据库使用独立的测试实例
- 测试后清理测试数据

### 4.3 端到端测试

- 关键业务流程进行端到端测试
- 使用测试工具（如Playwright、Cypress）

## 5. 监控和可观测性

### 5.1 日志记录

- 记录关键业务流程
- 使用结构化日志
- 包含足够的上下文信息
- 敏感信息脱敏

### 5.2 指标收集

- 使用Prometheus收集指标
- 监控QPS、响应时间、错误率
- 设置告警规则

### 5.3 链路追踪

- 使用OpenTelemetry进行链路追踪
- 传递TraceID和SpanID
- 记录关键操作的时间消耗

## 6. 文档编写建议

### 6.1 API文档

- 使用OpenAPI 3.0规范
- 提供请求/响应示例
- 说明错误码和错误处理
- 更新API变更日志

### 6.2 代码注释

- 公共API必须有注释
- 复杂业务逻辑必须有注释说明
- 使用清晰的注释说明"为什么"而不是"是什么"

### 6.3 用户文档

- 提供快速开始指南
- 包含常见问题解答
- 提供示例和最佳实践

## 7. 重构建议

### 7.1 代码重构

- 识别重复代码，提取公共函数
- 拆分过长的函数（建议不超过50行）
- 提取复杂逻辑为独立函数
- 使用设计模式提高代码质量

### 7.2 架构重构

- 识别服务边界，合理拆分微服务
- 优化服务间通信方式
- 统一错误处理和响应格式
- 优化数据库设计

## 8. 部署和运维建议

### 8.1 容器化

- 使用多阶段构建优化镜像大小
- 使用健康检查
- 合理设置资源限制
- 使用非root用户运行

### 8.2 配置管理

- 使用配置中心管理配置
- 支持环境变量覆盖
- 敏感配置加密存储
- 配置变更通知机制

### 8.3 高可用

- 服务多实例部署
- 使用负载均衡
- 实现服务降级和熔断
- 数据库主从复制

## 9. 团队协作建议

### 9.1 代码审查

- 及时响应代码审查请求
- 提供建设性的反馈
- 关注代码质量和架构设计
- 保持审查的客观性

### 9.2 知识分享

- 定期进行技术分享
- 记录技术决策和原因
- 维护技术文档和Wiki
- 建立团队知识库

### 9.3 持续改进

- 定期回顾项目进展
- 识别改进机会
- 实施改进措施
- 跟踪改进效果

---

**最后更新**: 2025-11-20  
**版本**: v1.0
