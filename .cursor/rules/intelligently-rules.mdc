---
alwaysApply: false
---

# StructForge 项目智能应用规则

> 这些规则会根据上下文智能应用，适用于开发流程、代码审查、推荐做法等场景。

## 1. 开发流程建议

### 1.1 本地开发环境

1. **环境准备**
   - Docker Desktop（用于PostgreSQL和Redis）
   - Node.js 18+（前端开发）
   - Go 1.21+（后端开发）
   - PostgreSQL客户端（可选，用于数据库管理）

2. **启动步骤**

   ```bash
   # 1. 启动基础设施
   docker-compose up -d postgres redis
   
   # 2. 运行数据库迁移
   make migrate-up
   
   # 3. 生成proto代码和wire代码
   cd backend
   make proto
   make wire
   
   # 4. 启动后端服务
   # 方式1: 使用Makefile启动所有服务
   make run
   
   # 方式2: 单独启动某个服务
   cd apps/gateway && go run cmd/gateway/main.go
   cd apps/user && go run cmd/user/main.go
   
   # 5. 启动前端
   cd ../../frontend && npm install && npm run dev
   ```

3. **开发调试**
   - 前端: Vite HMR自动热重载
   - 后端: 使用 `air` 工具实现热重载
   - API文档: 访问 `http://localhost:8000/api/docs`

### 1.2 代码提交

- **提交前检查**:
  - 运行测试：`make test`
  - 格式化代码：`make fmt`
  - 代码检查：`make lint`
  
- **提交信息规范**: 遵循Conventional Commits
  - `feat`: 新功能
  - `fix`: 修复bug
  - `docs`: 文档更新
  - `style`: 代码格式调整
  - `refactor`: 重构
  - `test`: 测试相关
  - `chore`: 构建/工具相关
  
  示例: `feat(workflow): 添加工作流执行引擎`

### 1.3 代码审查

- 所有代码必须经过审查才能合并到主分支
- 审查重点：
  - 代码质量（可读性、可维护性）
  - 架构合理性（是否符合Kratos规范）
  - 测试覆盖（核心逻辑是否有测试）
  - 安全性（是否有安全隐患）
  - 性能（是否有性能问题）

### 1.4 Git工作流

- **主分支**: `main`（生产环境）
- **开发分支**: `develop`（开发环境）
- **功能分支**: `feature/{功能名}`（新功能开发）
- **修复分支**: `fix/{问题描述}`（bug修复）
- **发布分支**: `release/{版本号}`（版本发布）

## 2. 推荐做法

### 2.1 代码质量

- 使用接口抽象，便于测试和扩展
- 错误处理要完善，避免panic
- 日志记录要详细，便于排查问题
- 代码要有注释，特别是复杂逻辑

### 2.2 前端组件开发流程

1. 新页面开发时，首先检查 `@/components/common/base` 是否已有所需组件
2. 如果已有组件，直接使用通用组件
3. 如果缺失组件，先在通用组件库中添加该组件（参考现有组件结构），然后在页面中使用
4. 对于复杂功能，通过组合多个基础组件创建预制组件（类似 Unity 预制物体），放在 `@/components/common/business/` 目录中
5. 保持组件 API 的一致性，便于后续维护和可视化编辑器使用

### 2.3 组件复用

- 将常用的组件组合封装为业务组件（预制组件），提高代码复用性和可维护性
- 便于未来可视化编辑器使用
- 新增组件时，必须遵循现有组件的结构和命名规范，提供完整的 TypeScript 类型定义和文档

### 2.4 文件组织原则

- 一个文件一个主要功能/类
- 相关功能放在同一目录
- 避免过长的文件（建议不超过500行）
- 使用合理的目录层级（建议不超过4层）

## 3. 扩展性规范

### 3.1 节点扩展

- 支持插件化节点系统
- 提供自定义节点开发SDK
- 节点实现放在 `node-service/internal/nodes/` 目录

### 3.2 模型扩展

- 模型适配器插件化
- 通过配置添加新模型
- 提供SDK便于开发新适配器

### 3.3 工具扩展

- 工具插件系统
- 支持第三方工具集成

## 4. 部署规范

### 4.1 开发环境

- 使用Docker Compose进行本地开发
- 所有服务运行在localhost
- 简化配置便于快速启动

### 4.2 生产环境

- 支持Kubernetes部署（可选）
- 服务高可用配置
- 负载均衡配置
- 自动扩缩容配置

## 5. 测试要求

- 核心业务逻辑必须有单元测试
- 关键接口必须有集成测试
- 测试覆盖率要求：核心模块 > 80%

## 6. 文档要求

- 公共API必须有注释
- 复杂业务逻辑必须有注释说明
- 新增功能需要更新相关文档

---

**最后更新**: 2025-11-20  
**版本**: v1.0
