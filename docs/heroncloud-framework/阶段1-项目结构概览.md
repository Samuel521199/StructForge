# é˜¶æ®µ1ï¼šHeronCloud-Game é¡¹ç›®ç»“æ„æ¦‚è§ˆ

## ğŸ“š å­¦ä¹ ç›®æ ‡
- ç†è§£é¡¹ç›®çš„æ•´ä½“ç›®å½•ç»“æ„
- äº†è§£å¾®æœåŠ¡æ¶æ„çš„åŸºæœ¬æ¦‚å¿µ
- è®¤è¯†Kratosæ¡†æ¶çš„æ ¸å¿ƒç»„ä»¶

---

## ğŸ—ï¸ é¡¹ç›®æ•´ä½“ç»“æ„

```
D:\heroncloud-game\
â”œâ”€â”€ api/                    # APIå®šä¹‰å±‚ï¼ˆProtobufåè®®å®šä¹‰ï¼‰
â”‚   â”œâ”€â”€ auth/v1/           # è®¤è¯æœåŠ¡API
â”‚   â”œâ”€â”€ gateway/v1/        # ç½‘å…³æœåŠ¡API
â”‚   â”œâ”€â”€ chat/v1/           # èŠå¤©æœåŠ¡API
â”‚   â””â”€â”€ common/v1/         # å…¬å…±APIå®šä¹‰
â”‚
â”œâ”€â”€ apps/                   # åº”ç”¨æœåŠ¡å±‚ï¼ˆå¾®æœåŠ¡å®ç°ï¼‰
â”‚   â”œâ”€â”€ gateway/           # ç½‘å…³æœåŠ¡ï¼ˆé‡ç‚¹å­¦ä¹ ï¼‰
â”‚   â”‚   â”œâ”€â”€ cmd/gateway/   # å¯åŠ¨å…¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ main.go    # ä¸»ç¨‹åºå…¥å£
â”‚   â”‚   â”‚   â””â”€â”€ wire.go    # ä¾èµ–æ³¨å…¥é…ç½®
â”‚   â”‚   â””â”€â”€ internal/      # å†…éƒ¨å®ç°
â”‚   â”‚       â”œâ”€â”€ conf/      # é…ç½®å®šä¹‰
â”‚   â”‚       â”œâ”€â”€ data/      # æ•°æ®è®¿é—®å±‚
â”‚   â”‚       â”œâ”€â”€ handler/   # HTTPå¤„ç†å™¨
â”‚   â”‚       â”œâ”€â”€ server/    # æœåŠ¡å™¨é…ç½®
â”‚   â”‚       â””â”€â”€ manager/   # è¿æ¥ç®¡ç†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ auth/              # è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ chat/              # èŠå¤©æœåŠ¡
â”‚   â””â”€â”€ ...                # å…¶ä»–æ¸¸æˆæœåŠ¡
â”‚
â”œâ”€â”€ common/                 # å…¬å…±ä»£ç åº“ï¼ˆæ¡†æ¶æ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ log/               # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ data/              # æ•°æ®è®¿é—®ï¼ˆRedisç­‰ï¼‰
â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ jwt/          # JWTè®¤è¯
â”‚   â”‚   â”œâ”€â”€ ratelimit/    # é™æµ
â”‚   â”‚   â”œâ”€â”€ tracing/      # é“¾è·¯è¿½è¸ª
â”‚   â”‚   â””â”€â”€ grpc/         # gRPCä¸­é—´ä»¶
â”‚   â”œâ”€â”€ server/            # æœåŠ¡å™¨é…ç½®
â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ websocket/         # WebSocketæ”¯æŒ
â”‚
â”œâ”€â”€ configs/               # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ local/            # æœ¬åœ°ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ test/             # æµ‹è¯•ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ prod/             # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚
â””â”€â”€ go.mod                 # Goæ¨¡å—ä¾èµ–å®šä¹‰
```

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µè¯´æ˜

### 1. **å¾®æœåŠ¡æ¶æ„**
- **ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ** å°†å¤§å‹åº”ç”¨æ‹†åˆ†æˆå¤šä¸ªç‹¬ç«‹çš„å°æœåŠ¡
- **ä¸ºä»€ä¹ˆç”¨å¾®æœåŠ¡ï¼Ÿ** 
  - æ¯ä¸ªæœåŠ¡å¯ä»¥ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²ã€æ‰©å±•
  - æ•…éšœéš”ç¦»ï¼Œä¸€ä¸ªæœåŠ¡å‡ºé—®é¢˜ä¸å½±å“å…¶ä»–æœåŠ¡
  - æŠ€æœ¯æ ˆå¯ä»¥ä¸åŒ

### 2. **Kratosæ¡†æ¶**
- **Kratosæ˜¯ä»€ä¹ˆï¼Ÿ** ä¸€ä¸ªGoè¯­è¨€çš„å¾®æœåŠ¡æ¡†æ¶ï¼ˆBilibiliå¼€æºï¼‰
- **æ ¸å¿ƒç‰¹æ€§ï¼š**
  - æ”¯æŒgRPCå’ŒHTTPä¸¤ç§åè®®
  - å†…ç½®æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†
  - åˆ†å±‚æ¶æ„ï¼šbizï¼ˆä¸šåŠ¡ï¼‰â†’ dataï¼ˆæ•°æ®ï¼‰â†’ serviceï¼ˆæœåŠ¡ï¼‰

### 3. **é¡¹ç›®åˆ†å±‚æ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   APIå±‚ (api/)                      â”‚
â”‚   Protobufåè®®å®šä¹‰                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨å±‚ (apps/)                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ Gateway  â”‚  â”‚  Auth    â”‚        â”‚
â”‚   â”‚ æœåŠ¡     â”‚  â”‚  æœåŠ¡    â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å…¬å…±å±‚ (common/)                   â”‚
â”‚   æ—¥å¿—ã€ä¸­é—´ä»¶ã€å·¥å…·ç­‰                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ å…³é”®ç›®å½•è¯¦è§£

### **apps/gateway/** - ç½‘å…³æœåŠ¡ï¼ˆé‡ç‚¹ï¼‰

ç½‘å…³æœåŠ¡æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å…¥å£ï¼Œè´Ÿè´£ï¼š
- æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆHTTP/WebSocketï¼‰
- è·¯ç”±åˆ°åç«¯å¾®æœåŠ¡
- ç»Ÿä¸€è®¤è¯ã€é™æµã€æ—¥å¿—

**ç›®å½•ç»“æ„ï¼š**
```
apps/gateway/
â”œâ”€â”€ cmd/gateway/          # å¯åŠ¨å…¥å£
â”‚   â”œâ”€â”€ main.go          # ç¨‹åºä¸»å…¥å£
â”‚   â””â”€â”€ wire.go          # ä¾èµ–æ³¨å…¥é…ç½®
â”‚
â”œâ”€â”€ internal/            # å†…éƒ¨å®ç°ï¼ˆä¸å¯¹å¤–æš´éœ²ï¼‰
â”‚   â”œâ”€â”€ conf/            # é…ç½®ç»“æ„å®šä¹‰
â”‚   â”œâ”€â”€ data/            # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ client/      # gRPCå®¢æˆ·ç«¯ï¼ˆè°ƒç”¨å…¶ä»–æœåŠ¡ï¼‰
â”‚   â”‚   â””â”€â”€ ratelimit/   # é™æµç®¡ç†å™¨
â”‚   â”œâ”€â”€ handler/         # HTTPè¯·æ±‚å¤„ç†å™¨
â”‚   â”œâ”€â”€ server/          # æœåŠ¡å™¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ http.go      # HTTPæœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ grpc.go      # gRPCæœåŠ¡å™¨
â”‚   â”‚   â””â”€â”€ websocket.go # WebSocketæœåŠ¡å™¨
â”‚   â””â”€â”€ manager/         # è¿æ¥ç®¡ç†å™¨
â”‚
â””â”€â”€ pkg/                 # å¯å¯¹å¤–æš´éœ²çš„åŒ…
    â””â”€â”€ pack/            # æ•°æ®åŒ…ç¼–è§£ç 
```

### **common/** - å…¬å…±æ¡†æ¶ä»£ç 

æ‰€æœ‰æœåŠ¡å…±äº«çš„ä»£ç ï¼ŒåŒ…æ‹¬ï¼š

```
common/
â”œâ”€â”€ log/                 # æ—¥å¿—ç³»ç»Ÿ
â”‚   â””â”€â”€ logger.go       # ç»Ÿä¸€çš„æ—¥å¿—æ¥å£
â”‚
â”œâ”€â”€ data/                # æ•°æ®è®¿é—®
â”‚   â””â”€â”€ redis/          # Rediså®¢æˆ·ç«¯å°è£…
â”‚
â”œâ”€â”€ middleware/          # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ jwt/            # JWTè®¤è¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ ratelimit/      # é™æµä¸­é—´ä»¶
â”‚   â””â”€â”€ grpc/           # gRPCä¸­é—´ä»¶
â”‚
â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
```

---

## ğŸ“ Goè¯­è¨€åŸºç¡€è¯­æ³•ï¼ˆå¿«é€Ÿå›é¡¾ï¼‰

### 1. **åŒ…ï¼ˆPackageï¼‰**
```go
package main  // å£°æ˜åŒ…å

import (
    "fmt"     // å¯¼å…¥æ ‡å‡†åº“
    "context" // å¯¼å…¥æ ‡å‡†åº“
)
```

### 2. **å‡½æ•°å®šä¹‰**
```go
// åŸºæœ¬å‡½æ•°
func functionName(param1 string, param2 int) (string, error) {
    return "result", nil
}

// å¤šè¿”å›å€¼
func divide(a, b int) (int, error) {
    if b == 0 {
        return 0, errors.New("é™¤æ•°ä¸èƒ½ä¸º0")
    }
    return a / b, nil
}
```

### 3. **ç»“æ„ä½“ï¼ˆStructï¼‰**
```go
// å®šä¹‰ç»“æ„ä½“
type User struct {
    ID       int64
    Username string
    Email    string
}

// ä½¿ç”¨ç»“æ„ä½“
user := User{
    ID:       1,
    Username: "å¼ ä¸‰",
    Email:    "zhangsan@example.com",
}
```

### 4. **æ¥å£ï¼ˆInterfaceï¼‰**
```go
// å®šä¹‰æ¥å£
type Writer interface {
    Write(data []byte) error
}

// å®ç°æ¥å£
type FileWriter struct{}

func (f *FileWriter) Write(data []byte) error {
    // å®ç°å†™å…¥é€»è¾‘
    return nil
}
```

### 5. **é”™è¯¯å¤„ç†**
```go
// Goè¯­è¨€æ²¡æœ‰å¼‚å¸¸ï¼Œä½¿ç”¨errorè¿”å›å€¼
result, err := someFunction()
if err != nil {
    // å¤„ç†é”™è¯¯
    return err
}
// ä½¿ç”¨result
```

### 6. **Contextï¼ˆä¸Šä¸‹æ–‡ï¼‰**
```go
// Contextç”¨äºä¼ é€’è¯·æ±‚ä¸Šä¸‹æ–‡ã€è¶…æ—¶æ§åˆ¶ç­‰
ctx := context.Background()                    // åˆ›å»ºæ ¹context
ctx, cancel := context.WithTimeout(ctx, 5*time.Second) // å¸¦è¶…æ—¶
defer cancel()                                 // ç¡®ä¿å–æ¶ˆ

// åœ¨å‡½æ•°é—´ä¼ é€’
func process(ctx context.Context) error {
    // æ£€æŸ¥æ˜¯å¦è¶…æ—¶
    select {
    case <-ctx.Done():
        return ctx.Err()
    default:
        // ç»§ç»­å¤„ç†
    }
    return nil
}
```

---

## ğŸ“ å­¦ä¹ å»ºè®®

1. **å…ˆç†è§£æ•´ä½“æ¶æ„**ï¼šä¸è¦ä¸€å¼€å§‹å°±æ·±å…¥ä»£ç ç»†èŠ‚
2. **é€æ­¥å­¦ä¹ **ï¼šæŒ‰ç…§é˜¶æ®µé¡ºåºï¼Œä¸€ä¸ªé˜¶æ®µä¸€ä¸ªé˜¶æ®µå®Œæˆ
3. **æ‰‹å†™ä»£ç **ï¼šæ¯æ®µä»£ç éƒ½è¦æ‰‹å†™ä¸€éï¼ŒåŠ æ·±ç†è§£
4. **è¿è¡Œæµ‹è¯•**ï¼šç†è§£åå°è¯•è¿è¡Œä»£ç ï¼Œè§‚å¯Ÿæ•ˆæœ
5. **æé—®æ€è€ƒ**ï¼šé‡åˆ°ä¸æ‡‚çš„åœ°æ–¹ï¼Œå…ˆæ€è€ƒå†æé—®

---

## ğŸ“Œ ä¸‹ä¸€é˜¶æ®µé¢„å‘Š

**é˜¶æ®µ2ï¼šç¨‹åºå…¥å£å’Œé…ç½®ç³»ç»Ÿ**
- å­¦ä¹  `main.go` å¦‚ä½•å¯åŠ¨æœåŠ¡
- ç†è§£é…ç½®æ–‡ä»¶çš„åŠ è½½è¿‡ç¨‹
- æŒæ¡ç¯å¢ƒå˜é‡çš„ä½¿ç”¨

---

## ğŸ’¡ æ€è€ƒé¢˜

1. ä¸ºä»€ä¹ˆè¦æŠŠä»£ç åˆ†æˆ `api/`ã€`apps/`ã€`common/` ä¸‰ä¸ªç›®å½•ï¼Ÿ
2. ç½‘å…³æœåŠ¡ï¼ˆgatewayï¼‰åœ¨æ•´ä¸ªç³»ç»Ÿä¸­æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿ
3. Goè¯­è¨€çš„é”™è¯¯å¤„ç†æ–¹å¼å’Œå…¶ä»–è¯­è¨€ï¼ˆå¦‚Javaçš„å¼‚å¸¸ï¼‰æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ

---

**å®Œæˆæœ¬é˜¶æ®µåï¼Œè¯·ç»§ç»­å­¦ä¹ é˜¶æ®µ2ï¼** ğŸš€

